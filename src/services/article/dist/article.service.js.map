{"version":3,"sources":["article.service.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,yCAA4C;AAC5C,2CAAmD;AACnD,sDAA2D;AAC3D,0EAAiE;AACjE,wDAAsD;AACtD,0DAAkD;AAMlD;IAAoC,kCAA2B;IAC3D,wBAEqB,OAA4B;IAC7C,yEAAyE;IAExD,YAAsC,EAGtC,cAA0C;QAR/D,YAUI,kBAAM,OAAO,CAAC,SAEjB;QAVoB,aAAO,GAAP,OAAO,CAAqB;QAG5B,kBAAY,GAAZ,YAAY,CAA0B;QAGtC,oBAAc,GAAd,cAAc,CAA4B;;IAI/D,CAAC;IACK,0CAAiB,GAAvB,UAAwB,IAAmB;uCAAG,OAAO;;;;;wBAC7C,UAAU,GAAY,IAAI,wBAAO,EAAE,CAAC;wBACxC,UAAU,CAAC,IAAI,GAAW,IAAI,CAAC,IAAI,CAAC;wBACpC,UAAU,CAAC,UAAU,GAAK,IAAI,CAAC,UAAU,CAAC;wBAC1C,UAAU,CAAC,OAAO,GAAQ,IAAI,CAAC,OAAO,CAAC;wBACvC,UAAU,CAAC,WAAW,GAAI,IAAI,CAAC,WAAW,CAAC;wBAExB,qBAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,EAAA;;wBAAlD,YAAY,GAAG,SAAmC;wBAElD,eAAe,GAAiB,IAAI,4BAAY,EAAE,CAAC;wBACvD,eAAe,CAAC,SAAS,GAAG,YAAY,CAAC,SAAS,CAAC;wBACnD,eAAe,CAAC,KAAK,GAAO,IAAI,CAAC,KAAK,CAAC;wBAEvC,qBAAM,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,eAAe,CAAC,EAAA;;wBAA7C,SAA6C,CAAC;8BAEb,EAAb,KAAA,IAAI,CAAC,QAAQ;;;6BAAb,CAAA,cAAa,CAAA;wBAAxB,OAAO;wBACR,iBAAiB,GAAmB,IAAI,uCAAc,EAAE,CAAC;wBAC7D,iBAAiB,CAAC,SAAS,GAAG,YAAY,CAAC,SAAS,CAAC;wBACrD,iBAAiB,CAAC,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;wBAChD,iBAAiB,CAAC,KAAK,GAAO,OAAO,CAAC,KAAK,CAAC;wBAE5C,qBAAM,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAAA;;wBAAjD,SAAiD,CAAC;;;wBANlC,IAAa,CAAA;;4BAS1B,qBAAM,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC,SAAS,EAAE;4BACtD,SAAS,EAAE;gCACP,UAAU;gCACV,iBAAiB;gCACjB,UAAU;gCACV,eAAe;6BAElB;yBACJ,CAAC,EAAA;4BARF,sBAAO,SAQL,EAAC;;;;KACN;IA/CQ,cAAc;QAD1B,mBAAU,EAAE;QAGJ,WAAA,0BAAgB,CAAC,wBAAO,CAAC,CAAA;QAGzB,WAAA,0BAAgB,CAAC,4BAAY,CAAC,CAAA;QAG9B,WAAA,0BAAgB,CAAC,uCAAc,CAAC,CAAA;OAR5B,cAAc,CAkDtB;IAAD,qBAAC;CAlDL,AAkDK,CAlD+B,iCAAkB,GAkDjD;AAlDQ,wCAAc","file":"article.service.js","sourcesContent":["import { Injectable } from \"@nestjs/common\";\r\nimport { InjectRepository } from \"@nestjs/typeorm\";\r\nimport { TypeOrmCrudService } from \"@nestjsx/crud-typeorm\";\r\nimport { ArticleFeature } from \"entities/article-feuters.entity\";\r\nimport { ArticlePrice } from \"entities/article-price\";\r\nimport { Article } from \"entities/article.entity\";\r\nimport { AddArticleDto } from \"src/dtos/article/add.article.dto\";\r\nimport { ApiResponse } from \"src/misc/api.response.class\";\r\nimport { Repository } from \"typeorm/repository/Repository\";\r\n\r\n@Injectable()\r\nexport class ArticleService extends TypeOrmCrudService<Article> {\r\n    constructor(\r\n        @InjectRepository(Article)\r\n        private readonly article: Repository<Article>,\r\n        //// Cim se spomene neki repozitori mora se evidentirati u osnovno modulu\r\n        @InjectRepository(ArticlePrice)\r\n        private readonly articlePrice: Repository<ArticlePrice>,\r\n\r\n        @InjectRepository(ArticleFeature)\r\n        private readonly articleFeature: Repository<ArticleFeature>,\r\n    ){\r\n        super(article);\r\n\r\n    }\r\n    async createFullArticle(data: AddArticleDto): Promise<Article | ApiResponse> {\r\n        let newArticle: Article = new Article();\r\n        newArticle.name         = data.name;\r\n        newArticle.categoryId   = data.categoryId;\r\n        newArticle.excerpt      = data.excerpt;\r\n        newArticle.description  = data.description;\r\n\r\n        let savedArticle = await this.article.save(newArticle);\r\n\r\n        let newArticlePrice: ArticlePrice = new ArticlePrice();\r\n        newArticlePrice.articleId = savedArticle.articleId;\r\n        newArticlePrice.price     = data.price;\r\n\r\n        await this.articlePrice.save(newArticlePrice);\r\n\r\n        for (let feature of data.features) {\r\n            let newArticleFeature: ArticleFeature = new ArticleFeature();\r\n            newArticleFeature.articleId = savedArticle.articleId;\r\n            newArticleFeature.featureId = feature.featureId;\r\n            newArticleFeature.value     = feature.value;\r\n\r\n            await this.articleFeature.save(newArticleFeature);\r\n        }\r\n\r\n        return await this.article.findOne(savedArticle.articleId, {\r\n            relations: [\r\n                \"category\",\r\n                \"articleFeatures\",\r\n                \"features\",\r\n                \"articlePrices\",\r\n                \r\n            ]\r\n        });\r\n    }\r\n\r\n\r\n    }\r\n"]}