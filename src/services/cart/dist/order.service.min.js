"use strict";var __decorate=this&&this.__decorate||function(e,r,t,n){var c,a=arguments.length,i=a<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,n);else for(var s=e.length-1;0<=s;s--)(c=e[s])&&(i=(a<3?c(i):3<a?c(r,t,i):c(r,t))||i);return 3<a&&i&&Object.defineProperty(r,t,i),i},__param=this&&this.__param||function(t,n){return function(e,r){n(e,r,t)}},__awaiter=this&&this.__awaiter||function(e,i,s,o){return new(s=s||Promise)(function(r,t){function n(e){try{a(o.next(e))}catch(e){t(e)}}function c(e){try{a(o.throw(e))}catch(e){t(e)}}function a(e){e.done?r(e.value):function(r){return r instanceof s?r:new s(function(e){e(r)})}(e.value).then(n,c)}a((o=o.apply(e,i||[])).next())})},__generator=this&&this.__generator||function(t,n){var c,a,i,e,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function r(r){return function(e){return function(r){if(c)throw new TypeError("Generator is already executing.");for(;s;)try{if(c=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=n.call(t,s)}catch(e){r=[6,e],a=0}finally{c=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,e])}}};exports.__esModule=!0;var common_1=require("@nestjs/common"),cart_entity_1=require("src/entities/cart.entity"),order_entity_1=require("src/entities/order.entity"),typeorm_1=require("@nestjs/typeorm"),api_response_class_1=require("src/misc/api.response.class"),OrderService=function(){function e(e,r){this.cart=e,this.order=r}return e.prototype.add=function(c){return __awaiter(this,void 0,Promise,function(){var r,t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,this.order.findOne({cartId:c})];case 1:return e.sent()?[2,new api_response_class_1.ApiResponse("error",-7001,"An order for this cart has already been made.")]:[4,this.cart.findOne(c,{relations:["cartArticles"]})];case 2:return(r=e.sent())?0===r.cartArticles.length?[2,new api_response_class_1.ApiResponse("error",-7003,"This cart is empty.")]:((t=new order_entity_1.Order).cartId=c,[4,this.order.save(t)]):[2,new api_response_class_1.ApiResponse("error",-7002,"No such cart found.")];case 3:return n=e.sent(),r.createdAt=new Date,[4,this.cart.save(r)];case 4:return e.sent(),[4,this.getById(n.orderId)];case 5:return[2,e.sent()]}})})},e.prototype.getById=function(r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.order.findOne(r,{relations:["cart","cart.user","cart.cartArticles","cart.cartArticles.article","cart.cartArticles.article.category","cart.cartArticles.article.articlePrices"]})];case 1:return[2,e.sent()]}})})},e.prototype.getAllByUserId=function(r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.order.find({where:{userId:r},relations:["cart","cart.user","cart.cartArticles","cart.cartArticles.article","cart.cartArticles.article.category","cart.cartArticles.article.articlePrices"]})];case 1:return[2,e.sent()]}})})},e.prototype.getAll=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.order.find({relations:["cart","cart.user","cart.cartArticles","cart.cartArticles.article","cart.cartArticles.article.category","cart.cartArticles.article.articlePrices"]})];case 1:return[2,e.sent()]}})})},e.prototype.changeStatus=function(t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getById(t)];case 1:return(r=e.sent())?(r.status=n,[4,this.order.save(r)]):[2,new api_response_class_1.ApiResponse("error",-9001,"No such order found!")];case 2:return e.sent(),[4,this.getById(t)];case 3:return[2,e.sent()]}})})},e=__decorate([common_1.Injectable(),__param(0,typeorm_1.InjectRepository(cart_entity_1.Cart)),__param(1,typeorm_1.InjectRepository(order_entity_1.Order))],e)}();exports.OrderService=OrderService;
//# sourceMappingURL=order.service.min.js.map
